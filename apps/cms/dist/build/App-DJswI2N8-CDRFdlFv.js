import{j as t,P as H,aT as $,R as le,a as X,A as ce,aA as z,aU as de,ao as F,T as R,B as b,r as f,aV as _,b as ue,u as B,f as pe,l as fe,v as W,U as w,e as y,D as me,s as he,h as ge,i as J,k as E,aW as G,m as I,W as xe,n as ye}from"./strapi-JxO5pAxa.js";var O=function(){return O=Object.assign||function(i){for(var r,o=1,s=arguments.length;o<s;o++){r=arguments[o];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a])}return i},O.apply(this,arguments)};function Q(e,i){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&i.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)i.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(r[o[s]]=e[o[s]]);return r}var ee={exports:{}},c={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y;function be(){if(Y)return c;Y=1;var e=typeof Symbol=="function"&&Symbol.for,i=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,o=e?Symbol.for("react.fragment"):60107,s=e?Symbol.for("react.strict_mode"):60108,a=e?Symbol.for("react.profiler"):60114,l=e?Symbol.for("react.provider"):60109,p=e?Symbol.for("react.context"):60110,u=e?Symbol.for("react.async_mode"):60111,x=e?Symbol.for("react.concurrent_mode"):60111,h=e?Symbol.for("react.forward_ref"):60112,j=e?Symbol.for("react.suspense"):60113,k=e?Symbol.for("react.suspense_list"):60120,C=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,m=e?Symbol.for("react.block"):60121,A=e?Symbol.for("react.fundamental"):60117,L=e?Symbol.for("react.responder"):60118,M=e?Symbol.for("react.scope"):60119;function g(n){if(typeof n=="object"&&n!==null){var d=n.$$typeof;switch(d){case i:switch(n=n.type,n){case u:case x:case o:case a:case s:case j:return n;default:switch(n=n&&n.$$typeof,n){case p:case h:case v:case C:case l:return n;default:return d}}case r:return d}}}function P(n){return g(n)===x}return c.AsyncMode=u,c.ConcurrentMode=x,c.ContextConsumer=p,c.ContextProvider=l,c.Element=i,c.ForwardRef=h,c.Fragment=o,c.Lazy=v,c.Memo=C,c.Portal=r,c.Profiler=a,c.StrictMode=s,c.Suspense=j,c.isAsyncMode=function(n){return P(n)||g(n)===u},c.isConcurrentMode=P,c.isContextConsumer=function(n){return g(n)===p},c.isContextProvider=function(n){return g(n)===l},c.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===i},c.isForwardRef=function(n){return g(n)===h},c.isFragment=function(n){return g(n)===o},c.isLazy=function(n){return g(n)===v},c.isMemo=function(n){return g(n)===C},c.isPortal=function(n){return g(n)===r},c.isProfiler=function(n){return g(n)===a},c.isStrictMode=function(n){return g(n)===s},c.isSuspense=function(n){return g(n)===j},c.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===o||n===x||n===a||n===s||n===j||n===k||typeof n=="object"&&n!==null&&(n.$$typeof===v||n.$$typeof===C||n.$$typeof===l||n.$$typeof===p||n.$$typeof===h||n.$$typeof===A||n.$$typeof===L||n.$$typeof===M||n.$$typeof===m)},c.typeOf=g,c}ee.exports=be();var je=ee.exports,te=je,Ce={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ve={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},ne={};ne[te.ForwardRef]=Ce;ne[te.Memo]=ve;function Te(e,i,r){if(r===void 0&&(r=Error),!e)throw new r(i)}var Se=function(e){},we=function(e){},Ee={formats:{},messages:{},timeZone:void 0,defaultLocale:"en",defaultFormats:{},fallbackOnEmptyString:!0,onError:Se,onWarn:we};function Ie(e){Te(e,"[React Intl] Could not find required `intl` object. <IntlProvider> needs to exist in the component ancestry.")}O(O({},Ee),{textComponent:f.Fragment});var q=typeof window<"u"&&!window.__REACT_INTL_BYPASS_GLOBAL_CONTEXT__?window.__REACT_INTL_CONTEXT__||(window.__REACT_INTL_CONTEXT__=f.createContext(null)):f.createContext(null);q.Consumer;q.Provider;var _e=q;function V(){var e=f.useContext(_e);return Ie(e),e}var K;(function(e){e.formatDate="FormattedDate",e.formatTime="FormattedTime",e.formatNumber="FormattedNumber",e.formatList="FormattedList",e.formatDisplayName="FormattedDisplayName"})(K||(K={}));var U;(function(e){e.formatDate="FormattedDateParts",e.formatTime="FormattedTimeParts",e.formatNumber="FormattedNumberParts",e.formatList="FormattedListParts"})(U||(U={}));function re(e){var i=function(r){var o=V(),s=r.value,a=r.children,l=Q(r,["value","children"]),p=typeof s=="string"?new Date(s||0):s,u=e==="formatDate"?o.formatDateToParts(p,l):o.formatTimeToParts(p,l);return a(u)};return i.displayName=U[e],i}function N(e){var i=function(r){var o=V(),s=r.value,a=r.children,l=Q(r,["value","children"]),p=o[e](s,l);if(typeof a=="function")return a(p);var u=o.textComponent||f.Fragment;return f.createElement(u,null,p)};return i.displayName=K[e],i}N("formatDate");N("formatTime");N("formatNumber");N("formatList");N("formatDisplayName");re("formatDate");re("formatTime");const T=()=>{const{formatMessage:e}=V();return{i18n:(r,o)=>e({id:`${_}.${r}`,defaultMessage:o})}};function oe(){const{toggleNotification:e}=he(),{i18n:i}=T();function r({type:s="info",message:a=i("plugin.message.something","Something occured in Meilisearch"),link:l,blockTransition:p=!0,title:u}){e({title:u,type:s,message:i("notification.meilisearch.message",a),link:l,blockTransition:p,onClose:()=>localStorage.setItem("STRAPI_UPDATE_NOTIF","true")})}return{handleNotification:r,checkForbiddenError:({response:s})=>{const a=s?.data?.error?.status;a&&a===403&&r({title:i("plugin.message.forbidden.title","Forbidden"),type:"warning",message:i("plugin.message.forbidden.description","You do not have permission to do this action"),blockTransition:!1})}}}function ke(){const[e,i]=f.useState([]),[r,o]=f.useState(!0),[s,a]=f.useState(!1),[l,p]=f.useState(!1),{handleNotification:u,checkForbiddenError:x}=oe(),{i18n:h}=T(),{get:j,del:k,post:C,put:v}=B(),m=()=>o(n=>!n),A=({indexed:n,listened:d})=>n&&d?h("plugin.table.td.hookingText.hooked","Hooked"):!n&&!d?"/":h("plugin.table.td.hookingText.reload","Reload needed"),L=async()=>{try{const{data:{data:n,error:d}}=await j(`/${_}/content-type/`);if(d)u({type:"warning",message:d.message,link:d.link});else{const D=n.contentTypes.map(S=>(S.reloadNeeded=A({indexed:S.indexed,listened:S.listened}),S)),ie=D.find(S=>S.reloadNeeded===h("plugin.table.td.hookingText.reload","Reload needed")),ae=D.find(S=>S.isIndexing===!0);p(!!ae),a(!!ie),i(D)}}catch(n){x(n)}},M=async({contentType:n})=>{try{const{data:{error:d}}=await k(`/${_}/content-type/${n}`);d?u({type:"warning",message:d.message,link:d.link}):(m(),u({type:"success",message:h("plugin.message.success.delete","Request to delete content-type is successful"),blockTransition:!1}))}catch(d){x(d)}},g=async({contentType:n})=>{try{const{data:{error:d}}=await C(`/${_}/content-type`,{contentType:n});console.log(d),d?u({type:"warning",message:d.message,link:d.link}):(m(),u({type:"success",message:h("plugin.message.success.add","Request to add a content-type is successful"),blockTransition:!1}))}catch(d){x(d)}},P=async({contentType:n})=>{try{const{data:{error:d}}=await v(`/${_}/content-type`,{contentType:n});d?u({type:"warning",message:d.message,link:d.link}):(m(),u({type:"success",message:h("plugin.message.success.update","Request to update content-type is successful"),blockTransition:!1}))}catch(d){x(d)}};return f.useEffect(()=>{L()},[r]),f.useEffect(()=>{let n;return l?n=setInterval(()=>{m()},1e3):clearInterval(n),()=>clearInterval(n)},[l]),{collections:e,deleteCollection:M,addCollection:g,updateCollection:P,reloadNeeded:s,refetchCollection:m,handleNotification:u}}const Ae=({entry:e,deleteCollection:i,addCollection:r,updateCollection:o})=>{const{i18n:s}=T(),{allowedActions:{canCreate:a,canUpdate:l,canDelete:p}}=F($.collections);return t.jsxs(J,{children:[(a||p)&&t.jsx(I,{children:t.jsx(xe,{"aria-label":`Select ${e.collection}`,onCheckedChange:()=>{e.indexed?i({contentType:e.contentType}):r({contentType:e.contentType})},checked:e.indexed})}),t.jsx(I,{children:t.jsx(y,{textColor:"neutral800",children:e.collection})}),t.jsx(I,{children:t.jsx(y,{textColor:"neutral800",children:e.indexed?s("plugin.table.td.yes","Yes"):s("plugin.table.td.no","No")})}),t.jsx(I,{children:t.jsx(y,{textColor:"neutral800",children:e.isIndexing?s("plugin.table.td.yes","Yes"):s("plugin.table.td.no","No")})}),t.jsx(I,{children:t.jsx(y,{textColor:"neutral800",children:e.indexUid})}),t.jsx(I,{children:t.jsxs(y,{textColor:"neutral800",children:[e.numberOfDocuments," / ",e.numberOfEntries]})}),t.jsx(I,{children:t.jsx(y,{textColor:"neutral800",children:e.reloadNeeded})}),l&&t.jsx(I,{children:t.jsx(ye,{children:t.jsx(b,{paddingLeft:1,children:e.indexed&&t.jsx(W,{onClick:()=>o({contentType:e.contentType}),size:"S",variant:"secondary",children:s("plugin.update","Update")})})})})]},e.contentType)},Re=f.memo(Ae),$e=()=>{const{i18n:e}=T(),{allowedActions:{canCreate:i,canUpdate:r,canDelete:o}}=F($.collections);return t.jsx(ge,{children:t.jsxs(J,{children:[(i||o)&&t.jsx(E,{children:t.jsx(G,{children:"INDEX"})}),t.jsx(E,{children:t.jsx(y,{variant:"sigma",children:e("plugin.table.header.name","NAME")})}),t.jsx(E,{children:t.jsx(y,{variant:"sigma",children:e("plugin.table.header.in-meilisearch","IN MEILISEARCH ?")})}),t.jsx(E,{children:t.jsx(y,{variant:"sigma",children:e("plugin.table.header.indexing","INDEXING ?")})}),t.jsx(E,{children:t.jsx(y,{variant:"sigma",children:e("plugin.table.header.index-name","INDEX NAME")})}),t.jsx(E,{children:t.jsx(y,{variant:"sigma",children:e("plugin.table.header.documents","DOCUMENTS")})}),t.jsx(E,{children:t.jsx(y,{variant:"sigma",children:e("plugin.table.header.hooks","HOOKS")})}),r&&t.jsx(E,{children:t.jsx(G,{children:"Actions"})})]})})},Fe=f.memo($e),Z="did-not-kill-server",Ne="server is down";function se(e,i){return new Promise(r=>{fetch(`${window.strapi.backendURL}/_health`,{method:"HEAD",mode:"no-cors",headers:{"Content-Type":"application/json","Keep-Alive":"false"}}).then(o=>{if(o.status>=400)throw new Error(Ne);if(!i)throw new Error(Z);r(e)}).catch(o=>{setTimeout(()=>se(e,o.message!==Z).then(r),100)})})}const Pe=()=>{const{collections:e,deleteCollection:i,addCollection:r,updateCollection:o,reloadNeeded:s,refetchCollection:a}=ke(),{lockAppWithAutoreload:l,unlockAppWithAutoreload:p}=ue(),{get:u}=B(),[x,h]=f.useState(!1),{i18n:j}=T(),k=6,C=10,v=async()=>{try{l(),await u(`/${_}/reload`,!0),await se(!0),h(!1)}catch(m){console.error(m)}finally{p(),a()}};return f.useEffect(()=>{x&&v()},[x]),t.jsxs(b,{background:"neutral100",children:[t.jsxs(pe,{colCount:C,rowCount:k,children:[t.jsx(Fe,{}),t.jsx(fe,{children:e.map(m=>t.jsx(Re,{entry:m,deleteCollection:i,addCollection:r,updateCollection:o},m.collection))})]}),s&&t.jsx(b,{padding:5,children:t.jsx(W,{onClick:()=>h(!0),children:j("plugin.reload-server","Reload server")})})]})},Oe=f.memo(Pe);function Le(){const[e,i]=f.useState({host:"",apiKey:"",ApiKeyIsFromConfigFile:!0,HostIsFromConfigFile:!0}),[r,o]=f.useState(!0),[s,a]=f.useState(""),[l,p]=f.useState(""),{handleNotification:u}=oe(),{i18n:x}=T(),{get:h,post:j}=B(),k=()=>o(m=>!m),C=async()=>{const{data:{error:m}}=await j(`/${_}/credential`,{apiKey:l,host:s});m?u({type:"warning",message:m.message,link:m.link}):(k(),u({type:"success",message:x("plugin.message.success.credentials","Credentials sucessfully updated!"),blockTransition:!1}))},v=async()=>{const{data:{data:m,error:A}}=await h(`/${_}/credential`);A?u({type:"warning",message:A.message,link:A.link}):(i(m),a(m.host),p(m.apiKey))};return f.useEffect(()=>{v()},[r]),{credentials:e,updateCredentials:C,setHost:a,setApiKey:p,host:s,apiKey:l}}const Me=()=>{const{host:e,apiKey:i,credentials:r,setHost:o,setApiKey:s,updateCredentials:a}=Le(),{i18n:l}=T(),{allowedActions:{canEdit:p}}=F($.settingsEdit);return t.jsxs(b,{children:[t.jsx(b,{padding:2,children:t.jsxs(w.Root,{id:"host",hint:l("plugin.tab.settings.input.url.hint","The URL on which your Meilisearch is running"),children:[t.jsx(w.Label,{children:l("plugin.tab.settings.input.url.label","Meilisearch URL")}),t.jsx(w.Input,{type:"text",name:"host",value:e,placeholder:l("plugin.tab.settings.input.url.placeholder","URL"),onChange:u=>o(u.target.value),disabled:r.HostIsFromConfigFile}),t.jsx(w.Hint,{})]})}),t.jsx(b,{padding:2,children:t.jsxs(w.Root,{id:"apiKey",hint:l("plugin.tab.settings.input.apiKey.hint","A valid API key with enough permission to create indexes (or the master key)."),children:[t.jsx(w.Label,{children:l("plugin.tab.settings.input.apiKey.label","Meilisearch API Key")}),t.jsx(w.Input,{type:"password",name:"apiKey",placeholder:l("plugin.tab.settings.input.apiKey.placeholder","API key"),value:i,onChange:u=>s(u.target.value),disabled:r.ApiKeyIsFromConfigFile}),t.jsx(w.Hint,{})]})}),t.jsx(b,{paddingTop:1,paddingLeft:2,children:t.jsxs(y,{variant:"pi",style:{color:"red"},children:[l("plugin.tab.settings.warning.credentials.1","Do not use this API key on your front-end as it has too much rights. Instead, use the public key available using")," ",t.jsx(me,{isExternal:!0,href:"https://www.meilisearch.com/docs/reference/api/keys#get-keys",children:t.jsx(y,{variant:"pi",style:{color:"red"},children:l("plugin.tab.settings.warning.credentials.2","the key route")})}),"."]})}),t.jsx(b,{paddingTop:2,paddingLeft:2,paddingRight:2,paddingBottom:2,children:p&&t.jsx(W,{variant:"secondary",onClick:()=>a(),disabled:r.ApiKeyIsFromConfigFile&&r.HostIsFromConfigFile,children:l("plugin.save","Save")})})]})},De=f.memo(Me),He=()=>t.jsx(b,{padding:5,children:t.jsx(De,{})}),Ke=()=>{const{i18n:e}=T(),{allowedActions:i}=F($.collections),{allowedActions:r}=F($.settings),o=Object.values(i).some(a=>!!a),s=Object.values(r).some(a=>!!a);return t.jsxs(R.Root,{defaultValue:"collections",children:[t.jsxs(R.List,{children:[t.jsx(R.Trigger,{value:"collections",children:e("plugin.tab.collections","Collections")}),t.jsx(R.Trigger,{value:"settings",children:e("plugin.tab.settings","Settings")})]}),t.jsx(R.Content,{value:"collections",children:o&&t.jsx(b,{color:"neutral800",padding:4,background:"neutral0",children:t.jsx(Oe,{})})}),t.jsx(R.Content,{value:"settings",children:s&&t.jsx(b,{color:"neutral800",padding:4,background:"neutral0",children:t.jsx(He,{})})})]})},Ue=()=>{const{i18n:e}=T();return t.jsx(ce,{children:t.jsxs(H.Main,{children:[t.jsx(z.Header,{title:e("plugin.name","Meilisearch"),subtitle:e("plugin.description","Search in your content-types with the Meilisearch plugin"),navigationAction:t.jsx(de,{})}),t.jsx(z.Content,{children:t.jsx(Ke,{})})]})})},We=()=>t.jsx(H.Protect,{permissions:$.main,children:t.jsxs(le,{children:[t.jsx(X,{index:!0,element:t.jsx(Ue,{})}),t.jsx(X,{path:"*",element:t.jsx(H.Error,{})})]})});export{We as App};
