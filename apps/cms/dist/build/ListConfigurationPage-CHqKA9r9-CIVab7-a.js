import{dz as I,b$ as Y,s as N,an as G,dO as k,dV as Q,gr as q,r as f,g1 as J,j as e,bC as K,P as L,aA as P,dI as X,aB as z,dH as S,dP as Z,b_ as ee,ct as x,fZ as u,gs as H,dK as $,aU as te,dF as se,g8 as ae,dM as O,dQ as D,aC as _,dC as ne,gh as oe,dw as U,gm as w,gt as ie,ev as re,gu as le,gv as de,gw as C,eC as ce,fW as ue,J as E,bf as ge,at as pe,aw as me,av as fe}from"./strapi-BFIgV8L0.js";import{u as he}from"./hooks-E5u1mcgM-CVccEGN-.js";import{s as be}from"./objects-D6yBsdmx-C6vaOwn0.js";import{C as B}from"./CardDragPreview-DOxamsuj-Bec5wtWH.js";import{u as ye,I as je}from"./useDragAndDrop-DJ6jqvZN-sdSIzR7E.js";import{F as xe}from"./FieldTypeIcon-CMlNO8PE-tfgYZb3z.js";import{g as Se}from"./getEmptyImage-CjqolaH3.js";const ve=({name:t})=>{const{formatMessage:c}=I(),l=ee(),n=x("Header",g=>g.modified),m=x("Header",g=>g.isSubmitting);return e.jsx(P.Header,{navigationAction:e.jsx(te,{fallback:`../${se}/${l.slug}`}),primaryAction:e.jsx($,{size:"S",disabled:!n,type:"submit",loading:m,children:c({id:"global.save",defaultMessage:"Save"})}),subtitle:c({id:u("components.SettingsViewWrapper.pluginHeader.description.list-settings"),defaultMessage:"Define the settings of the list view."}),title:c({id:u("components.SettingsViewWrapper.pluginHeader.title"),defaultMessage:"Configure the view - {name}"},{name:H(t)})})},Me=["media","richtext","dynamiczone","relation","component","json","blocks"],Ce=()=>{const{formatMessage:t,locale:c}=I(),l=ae(c,{sensitivity:"base"}),{schema:n}=k(),m=x("Settings",o=>o.values.layout??[]),g=x("Settings",o=>o.values.settings.defaultSortBy),b=x("Settings",o=>o.onChange),i=f.useMemo(()=>Object.values(m).reduce((o,a)=>(n&&!Me.includes(n.attributes[a.name].type)&&o.push({value:a.name,label:typeof a.label!="string"?t(a.label):a.label}),o),[]),[t,m,n]).sort((o,a)=>l.compare(o.label,a.label));f.useEffect(()=>{i.findIndex(o=>o.value===g)===-1&&b("settings.defaultSortBy",i[0]?.value)},[g,b,i]);const h=f.useMemo(()=>Fe.map(o=>o.map(a=>a.type==="enumeration"?{...a,hint:a.hint?t(a.hint):void 0,label:t(a.label),options:a.name==="settings.defaultSortBy"?i:a.options}:{...a,hint:a.hint?t(a.hint):void 0,label:t(a.label)})),[t,i]);return e.jsxs(S,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(O,{variant:"delta",tag:"h2",children:t({id:u("containers.SettingPage.settings"),defaultMessage:"Settings"})}),e.jsx(D.Root,{gap:4,children:h.map(o=>o.map(({size:a,...p})=>e.jsx(D.Item,{s:12,col:a,direction:"column",alignItems:"stretch",children:e.jsx(_,{...p})},p.name)))},"bottom")]})},Fe=[[{label:{id:u("form.Input.search"),defaultMessage:"Enable search"},name:"settings.searchable",size:4,type:"boolean"},{label:{id:u("form.Input.filters"),defaultMessage:"Enable filters"},name:"settings.filterable",size:4,type:"boolean"},{label:{id:u("form.Input.bulkActions"),defaultMessage:"Enable bulk actions"},name:"settings.bulkable",size:4,type:"boolean"}],[{hint:{id:u("form.Input.pageEntries.inputDescription"),defaultMessage:"Note: You can override this value in the Collection Type settings page."},label:{id:u("form.Input.pageEntries"),defaultMessage:"Entries per page"},name:"settings.pageSize",options:["10","20","50","100"].map(t=>({value:t,label:t})),size:6,type:"enumeration"},{label:{id:u("form.Input.defaultSort"),defaultMessage:"Default sort attribute"},name:"settings.defaultSortBy",options:[],size:3,type:"enumeration"},{label:{id:u("form.Input.sort.order"),defaultMessage:"Default sort order"},name:"settings.defaultSortOrder",options:["ASC","DESC"].map(t=>({value:t,label:t})),size:3,type:"enumeration"}]],Ie=pe().shape({label:fe().required(),sortable:me()}),Re=({attribute:t,name:c,onClose:l})=>{const{formatMessage:n}=I(),{toggleNotification:m}=N(),{value:g,onChange:b}=ge(c);if(!g)return console.error("You've opened a field to edit without it being part of the form, this is likely a bug with Strapi. Please open an issue."),m({message:n({id:"content-manager.containers.list-settings.modal-form.error",defaultMessage:"An error occurred while trying to open the form."}),type:"danger"}),null;let d=!["media","relation"].includes(t.type);return"relation"in t&&["oneWay","oneToOne","manyToOne"].includes(t.relation)&&(d=!0),e.jsx(C.Content,{children:e.jsxs(z,{method:"PUT",initialValues:g,validationSchema:Ie,onSubmit:i=>{b(c,i),l()},children:[e.jsx(C.Header,{children:e.jsxs(Ee,{children:[e.jsx(xe,{type:t.type}),e.jsx(C.Title,{children:n({id:u("containers.list-settings.modal-form.label"),defaultMessage:"Edit {fieldName}"},{fieldName:H(g.label)})})]})}),e.jsx(C.Body,{children:e.jsx(D.Root,{gap:4,children:[{name:"label",label:n({id:u("form.Input.label"),defaultMessage:"Label"}),hint:n({id:u("form.Input.label.inputDescription"),defaultMessage:"This value overrides the label displayed in the table's head"}),size:6,type:"string"},{label:n({id:u("form.Input.sort.field"),defaultMessage:"Enable sort on this field"}),name:"sortable",size:6,type:"boolean"}].filter(i=>i.name!=="sortable"||i.name==="sortable"&&d).map(({size:i,...h})=>e.jsx(D.Item,{s:12,col:i,direction:"column",alignItems:"stretch",children:e.jsx(_,{...h})},h.name))})}),e.jsxs(C.Footer,{children:[e.jsx($,{onClick:l,variant:"tertiary",children:n({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),e.jsx($,{type:"submit",children:n({id:"global.finish",defaultMessage:"Finish"})})]})]})})},Ee=E(S)`
  svg {
    width: 3.2rem;
    margin-right: ${({theme:t})=>t.spaces[3]};
  }
`,Te=({attribute:t,index:c,isDraggingSibling:l,label:n,name:m,onMoveField:g,onRemoveField:b,setIsDraggingSibling:d})=>{const[i,h]=f.useState(!1),{formatMessage:o}=I(),[,a]=f.useState(!1),[{isDragging:p},y,v,F,j]=ye(!0,{type:je.FIELD,item:{index:c,label:n,name:m},index:c,onMoveItem:g,onEnd:()=>d(!1)});f.useEffect(()=>{j(Se(),{captureDraggingState:!1})},[j]),f.useEffect(()=>{p&&d(!0)},[p,d]),f.useEffect(()=>{l||a(r=>!r)},[l]);const s=le(v,y);return e.jsxs(Le,{ref:s,children:[p&&e.jsx(B,{label:n}),!p&&l&&e.jsx(B,{isSibling:!0,label:n}),!p&&!l&&e.jsxs(De,{borderColor:"neutral150",background:"neutral100",hasRadius:!0,justifyContent:"space-between",onClick:()=>h(!0),children:[e.jsxs(S,{gap:3,children:[e.jsx(we,{ref:F,"aria-label":o({id:u("components.DraggableCard.move.field"),defaultMessage:"Move {item}"},{item:n}),onClick:r=>r.stopPropagation(),children:e.jsx(de,{})}),e.jsx(O,{fontWeight:"bold",children:n})]}),e.jsxs(S,{paddingLeft:3,onClick:r=>r.stopPropagation(),children:[e.jsxs(C.Root,{open:i,onOpenChange:h,children:[e.jsx(C.Trigger,{children:e.jsx(A,{onClick:r=>{r.stopPropagation()},"aria-label":o({id:u("components.DraggableCard.edit.field"),defaultMessage:"Edit {item}"},{item:n}),type:"button",children:e.jsx(ce,{width:"1.2rem",height:"1.2rem"})})}),e.jsx(Re,{attribute:t,name:`layout.${c}`,onClose:()=>{h(!1)}})]}),e.jsx(A,{onClick:b,"data-testid":`delete-${m}`,"aria-label":o({id:u("components.DraggableCard.delete.field"),defaultMessage:"Delete {item}"},{item:n}),type:"button",children:e.jsx(ue,{width:"1.2rem",height:"1.2rem"})})]})]})]})},A=E.button`
  display: flex;
  align-items: center;
  height: ${({theme:t})=>t.spaces[7]};
  color: ${({theme:t})=>t.colors.neutral600};

  &:hover {
    color: ${({theme:t})=>t.colors.neutral700};
  }

  &:last-child {
    padding: 0 ${({theme:t})=>t.spaces[3]};
  }
`,we=E(A)`
  padding: 0 ${({theme:t})=>t.spaces[3]};
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
  cursor: all-scroll;
`,De=E(S)`
  max-height: 3.2rem;
  cursor: pointer;
`,Le=E(U)`
  &:last-child {
    padding-right: ${({theme:t})=>t.spaces[3]};
  }
`,Pe=()=>{const{formatMessage:t}=I(),{model:c,schema:l}=k(),[n,m]=f.useState(!1),[g,b]=f.useState(null),d=f.useRef(null),i=x("SortDisplayedFields",s=>s.values.layout??[]),h=x("SortDisplayedFields",s=>s.addFieldRow),o=x("SortDisplayedFields",s=>s.removeFieldRow),a=x("SortDisplayedFields",s=>s.moveFieldRow),{metadata:p}=ne(c,{selectFromResult:({data:s})=>({metadata:s?.contentType.metadatas??{}})}),y=f.useMemo(()=>{if(!l)return[];const s=i.map(r=>r.name);return Object.entries(l.attributes).reduce((r,[M,R])=>{if(!s.includes(M)&&oe(R)){const{list:T}=p[M];r.push({name:M,label:T.label||M,sortable:T.sortable})}return r},[])},[p,i,l]),v=s=>{b("add"),h("layout",s)},F=s=>{b("remove"),o("layout",s)},j=(s,r)=>{a("layout",s,r)};return f.useEffect(()=>{g==="add"&&d?.current&&(d.current.scrollLeft=d.current.scrollWidth)},[g]),e.jsxs(S,{alignItems:"stretch",direction:"column",gap:4,children:[e.jsx(O,{variant:"delta",tag:"h2",children:t({id:u("containers.SettingPage.view"),defaultMessage:"View"})}),e.jsxs(S,{padding:4,borderColor:"neutral300",borderStyle:"dashed",borderWidth:"1px",hasRadius:!0,children:[e.jsx(U,{flex:"1",overflow:"auto hidden",ref:d,children:e.jsx(S,{gap:3,children:i.map((s,r)=>e.jsx(Te,{index:r,isDraggingSibling:n,onMoveField:j,onRemoveField:()=>F(r),setIsDraggingSibling:m,...s,attribute:l.attributes[s.name],label:typeof s.label=="object"?t(s.label):s.label},s.name))})}),e.jsxs(w.Root,{children:[e.jsxs(w.Trigger,{paddingLeft:2,paddingRight:2,justifyContent:"center",endIcon:null,disabled:y.length===0,variant:"tertiary",children:[e.jsx(ie,{tag:"span",children:t({id:u("components.FieldSelect.label"),defaultMessage:"Add a field"})}),e.jsx(re,{"aria-hidden":!0,focusable:!1,style:{position:"relative",top:2}})]}),e.jsx(w.Content,{children:y.map(s=>e.jsx(w.Item,{onSelect:()=>v(s),children:typeof s.label=="object"?t(s.label):s.label},s.name))})]})]})]})},$e=()=>{const{formatMessage:t}=I(),{trackUsage:c}=Y(),{toggleNotification:l}=N(),{_unstableFormatAPIError:n}=G(),{model:m,collectionType:g}=k(),{isLoading:b,list:d,edit:i}=Q(),[h]=q(),o=async p=>{try{c("willSaveContentTypeLayout");const y=p.layout??[],v=Object.entries(i.metadatas).reduce((j,[s,r])=>{const{mainField:M,...R}=d.metadatas[s],{label:T,sortable:V}=y.find(W=>W.name===s)??{};return j[s]={edit:r,list:{...R,label:T||R.label,sortable:V||R.sortable}},j},{}),F=await h({layouts:{edit:i.layout.flatMap(j=>j.map(s=>s.map(({name:r,size:M})=>({name:r,size:M})))),list:y.map(j=>j.name)},settings:be(p.settings,"displayName",void 0),metadatas:v,uid:m});"data"in F?(c("didEditListSettings"),l({type:"success",message:t({id:"notification.success.saved",defaultMessage:"Saved"})})):l({type:"danger",message:n(F.error)})}catch(y){console.error(y),l({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})}},a=f.useMemo(()=>({layout:d.layout.map(({label:p,sortable:y,name:v})=>({label:typeof p=="string"?p:t(p),sortable:y,name:v})),settings:d.settings}),[t,d.layout,d.settings]);return g===J?e.jsx(K,{to:`/single-types/${m}`}):b?e.jsx(L.Loading,{}):e.jsxs(P.Root,{children:[e.jsx(L.Title,{children:`Configure ${d.settings.displayName} List View`}),e.jsx(X,{children:e.jsxs(z,{initialValues:a,onSubmit:o,method:"PUT",children:[e.jsx(ve,{collectionType:g,model:m,name:d.settings.displayName??""}),e.jsx(P.Content,{children:e.jsxs(S,{alignItems:"stretch",background:"neutral0",direction:"column",gap:6,hasRadius:!0,shadow:"tableShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:[e.jsx(Ce,{}),e.jsx(Z,{}),e.jsx(Pe,{})]})})]})})]})},_e=()=>{const t=he(c=>c.admin_app.permissions.contentManager?.collectionTypesConfigurations);return e.jsx(L.Protect,{permissions:t,children:e.jsx($e,{})})};export{$e as ListConfiguration,_e as ProtectedListConfiguration};
