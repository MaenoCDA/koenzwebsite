import{aY as H,ad as B,dz as w,cC as G,r as m,j as e,P as D,fZ as T,bC as E,aA as Y,c$ as Q,s as U,d1 as K,go as Z,an as J,cP as V,gx as q,gD as X,dw as I,b1 as ee,g6 as te,gE as se,g8 as ne,gF as ae,gG as re,g4 as ie,g3 as oe,gH as le,dH as y,fU as k,gv as N,dM as v,dT as ce,fW as de,gI as ue,gJ as pe,c8 as ge,dF as fe,g1 as he,J as F}from"./strapi-BzDuHlVM.js";import{C as me}from"./CardDragPreview-DOxamsuj-BtvipRpA.js";import{F as ye,L as Te,D as xe}from"./Relations-CdwpXmkU-HCM4PvEA.js";import{a as je,u as P}from"./hooks-E5u1mcgM-BzAYGjrq.js";import{I as S}from"./useDragAndDrop-DJ6jqvZN-tuVDES0C.js";import{u as Le}from"./useDragLayer-bExgnpSA.js";import"./relations-DoTBvOJA-Dj3eB_oY.js";import"./getEmptyImage-CjqolaH3.js";function Ce(s,r,n){if(!s||!r||!n)return{display:"none"};const{x:t,y:d}=n;return{transform:`translate(${t}px, ${d}px)`}}const be=({renderItem:s})=>{const{itemType:r,isDragging:n,item:t,initialOffset:d,currentOffset:o,mouseOffset:u}=Le(a=>({item:a.getItem(),itemType:a.getItemType(),initialOffset:a.getInitialSourceClientOffset(),currentOffset:a.getSourceClientOffset(),isDragging:a.isDragging(),mouseOffset:a.getClientOffset()}));return n?e.jsx(I,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:e.jsx(I,{style:Ce(d,o,u),children:s({type:r,item:t})})}):null},Se=({displayedValue:s})=>e.jsxs(y,{background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:3,padding:3,width:"30rem",children:[e.jsx(Me,{type:"button",children:e.jsxs(y,{gap:6,children:[e.jsx(Ie,{alignItems:"center",justifyContent:"center",background:"neutral200",height:"3.2rem",width:"3.2rem",children:e.jsx(ue,{})}),e.jsx(y,{maxWidth:"15rem",children:e.jsx(v,{textColor:"neutral700",ellipsis:!0,children:s})})]})}),e.jsxs(y,{gap:2,children:[e.jsx(k,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(pe,{})}),e.jsx(k,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(N,{})})]})]}),Ie=F(y)`
  border-radius: 50%;

  svg {
    height: 0.6rem;
    width: 1.1rem;
    > path {
      fill: ${({theme:s})=>s.colors.neutral600};
    }
  }
`,Me=F.button`
  border: none;
  background: transparent;
  display: block;
  width: 100%;
  text-align: unset;
  padding: 0;
`,De=({status:s,displayedValue:r,width:n})=>e.jsx(I,{style:{width:n},children:e.jsxs(y,{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:4,hasRadius:!0,borderWidth:1,background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:4,children:[e.jsxs(ye,{gap:1,children:[e.jsx(k,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(N,{})}),e.jsxs(y,{width:"100%",minWidth:0,justifyContent:"space-between",children:[e.jsx(I,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:e.jsx(Te,{href:"",children:e.jsx(v,{textColor:"primary600",ellipsis:!0,children:r})})}),s?e.jsx(ce,{status:s}):null]})]}),e.jsx(xe,{type:"button",children:e.jsx(de,{width:"12px"})})]})}),Ee=()=>{const[s,r]=m.useState(""),[{query:n}]=ee(),{formatMessage:t,locale:d}=w(),o=P(p=>p["content-manager"].app.collectionTypeLinks),u=P(p=>p["content-manager"].app.singleTypeLinks),{schemas:a}=te(),{startsWith:i}=se(d,{sensitivity:"base"}),l=ne(d,{sensitivity:"base"});m.useMemo(()=>[{id:"collectionTypes",title:t({id:T("components.LeftMenu.collection-types"),defaultMessage:"Collection Types"}),searchable:!0,links:o},{id:"singleTypes",title:t({id:T("components.LeftMenu.single-types"),defaultMessage:"Single Types"}),searchable:!0,links:u}].map(p=>({...p,links:p.links.filter(g=>i(g.title,s)).sort((g,C)=>l.compare(g.title,C.title)).map(g=>({...g,title:t({id:g.title,defaultMessage:g.title})}))})),[o,s,u,i,t,l]);const x=()=>{r("")},c=({target:{value:p}})=>{r(p)},f=t({id:T("header.name"),defaultMessage:"Content Manager"}),M=p=>{const C=!!a.find(j=>j.uid===p.uid)?.pluginOptions?.i18n?.localized;if(n.plugins&&"i18n"in n.plugins){const{i18n:j,...b}=n.plugins;return C?{i18n:j,...b}:b}return n.plugins};return e.jsxs(ae,{"aria-label":f,children:[e.jsx(re,{label:f,searchable:!0,value:s,onChange:c,onClear:x,searchLabel:t({id:"content-manager.components.LeftMenu.Search.label",defaultMessage:"Search for a content type"})}),e.jsx(ie,{area:"menu.left-menu",props:{schemas:a,getPluginsParamsForLink:M}})]})},{MUTATE_COLLECTION_TYPES_LINKS:ke,MUTATE_SINGLE_TYPES_LINKS:Pe}=oe,we=()=>{const{toggleNotification:s}=U(),r=je(),n=K("useContentManagerInitData",c=>c.runHookWaterfall),{notifyStatus:t}=Z(),{formatMessage:d}=w(),{_unstableFormatAPIError:o}=J(T),u=V("useContentManagerInitData",c=>c.checkUserHasPermissions),a=P(c=>c["content-manager"].app),i=q(void 0,{refetchOnMountOrArgChange:!0});m.useEffect(()=>{i.data&&t(d({id:T("App.schemas.data-loaded"),defaultMessage:"The schemas have been successfully loaded."}))},[d,i.data,t]),m.useEffect(()=>{i.error&&s({type:"danger",message:o(i.error)})},[o,i.error,s]);const l=X();m.useEffect(()=>{l.error&&s({type:"danger",message:o(l.error)})},[o,l.error,s]);const x=async(c,f,M,p)=>{const{collectionType:g,singleType:C}=f.reduce((h,L)=>(h[L.kind].push(L),h),{collectionType:[],singleType:[]}),j=O(g,"collectionTypes",p),b=O(C,"singleTypes"),A=await Promise.all(j.map(({permissions:h})=>u(h))),_=j.filter((h,L)=>A[L].length>0),R=await Promise.all(b.map(({permissions:h})=>u(h))),$=b.filter((h,L)=>R[L].length>0),{ctLinks:z}=n(ke,{ctLinks:_,models:f}),{stLinks:W}=n(Pe,{stLinks:$,models:f});r(le({authorizedCollectionTypeLinks:z,authorizedSingleTypeLinks:W,components:c,contentTypeSchemas:f,fieldSizes:M}))};return m.useEffect(()=>{i.data&&l.data&&x(i.data.components,i.data.contentTypes,i.data.fieldSizes,l.data)},[i.data,l.data]),{...a}},O=(s,r,n=[])=>s.filter(t=>t.isDisplayed).map(t=>{const d=[{action:"plugin::content-manager.explorer.create",subject:t.uid},{action:"plugin::content-manager.explorer.read",subject:t.uid}],o=[{action:"plugin::content-manager.explorer.read",subject:t.uid}],u=r==="collectionTypes"?d:o,a=n.find(({uid:l})=>l===t.uid);let i=null;if(a){const l={page:1,pageSize:a.settings.pageSize,sort:`${a.settings.defaultSortBy}:${a.settings.defaultSortOrder}`};i=ge.stringify(l,{encode:!1})}return{permissions:u,search:i,kind:t.kind,title:t.info.displayName,to:`/content-manager/${t.kind==="collectionType"?fe:he}/${t.uid}`,uid:t.uid,name:t.uid,isDisplayed:t.isDisplayed}}),We=()=>{const s=H("/content-manager/:kind/:uid/*"),{isLoading:r,collectionTypeLinks:n,models:t,singleTypeLinks:d}=we(),o=[...n,...d].sort((c,f)=>c.title.localeCompare(f.title)),{pathname:u}=B(),{formatMessage:a}=w(),i=G("Layout",c=>c.startSection),l=m.useRef(i);if(m.useEffect(()=>{l.current&&l.current("contentManager")},[]),r)return e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:T("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(D.Loading,{})]});const x=t.filter(({isDisplayed:c})=>c);return o.length===0&&x.length>0&&u!=="/content-manager/403"?e.jsx(E,{to:"/403"}):x.length===0&&u!=="/no-content-types"?e.jsx(E,{to:"/no-content-types"}):!s&&o.length>0?e.jsx(E,{to:{pathname:o[0].to,search:o[0].search??""},replace:!0}):e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:T("plugin.name"),defaultMessage:"Content Manager"})}),e.jsxs(Y.Root,{sideNav:e.jsx(Ee,{}),children:[e.jsx(be,{renderItem:Oe}),e.jsx(Q,{})]})]})};function Oe({type:s,item:r}){if(!s||s&&typeof s!="string")return null;const[n]=s.split("_");switch(n){case S.EDIT_FIELD:case S.FIELD:return e.jsx(me,{label:r.label});case S.COMPONENT:case S.DYNAMIC_ZONE:return e.jsx(Se,{displayedValue:r.displayedValue});case S.RELATION:return e.jsx(De,{...r});default:return null}}export{We as Layout};
