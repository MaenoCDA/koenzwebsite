import{ad as lt,b1 as dt,dz as tt,s as ct,dO as et,r as st,dU as ut,dB as ft,j as r,P as j,dI as ht,aB as pt,fY as mt,fX as R,fZ as A,dQ as O,f_ as gt,f$ as bt,g0 as G,b_ as yt,ao as xt,dx as wt,g1 as Et,J as St,dH as Q,dw as kt,dy as jt,aa as it}from"./strapi-JxO5pAxa.js";import{a as Ot,f as _t,t as Pt,g as Y}from"./Field-BbrhLACK-s41h68pS.js";import"./Relations-CdwpXmkU-PLWyjZA8.js";import"./useDragAndDrop-DJ6jqvZN-sBTeB5bf.js";import"./relations-DoTBvOJA-CRWRYscE.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-D5zbLund.js";import"./objects-D6yBsdmx-DWrs8uI8.js";import"./useDebounce-DmuSJIF3-DgmpUwN_.js";var x=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},D={},N={},v={};Object.defineProperty(v,"__esModule",{value:!0});v.unlisten=v.listen=void 0;const L=[],$=[];function vt(t){return{el:t,callbacks:{},realCallbacks:{},realListenersCnt:0}}function It(t,e,s){if(t.callbacks[e]){t.callbacks[e].indexOf(s)===-1&&t.callbacks[e].push(s);return}t.callbacks[e]=[s],t.realCallbacks[e]=i=>{for(let n=0,a=t.callbacks[e].length;n<a;n+=1)t.callbacks[e][n](i)},t.el.addEventListener(e,t.realCallbacks[e]),t.realListenersCnt+=1}function Ct(t,e,s){if(!t.callbacks[e])return;const i=t.callbacks[e].indexOf(s);i!==-1&&(t.callbacks[e].splice(i,1),!(t.callbacks[e].length>0)&&(t.el.removeEventListener(e,t.realCallbacks[e]),delete t.callbacks[e],delete t.realCallbacks[e],t.realListenersCnt-=1))}function Tt(t,e,s){let i=L.indexOf(t);i===-1&&(i=L.length,L.push(t),$.push(vt(t)));const n=$[i];It(n,e,s)}function Mt(t,e,s){const i=L.indexOf(t);if(i===-1)return;const n=$[i];Ct(n,e,s),!(n.realListenersCnt>0)&&(L.splice(i,1),$.splice(i,1))}function Rt(t,e,s){for(let i=0,n=e.length;i<n;i+=1)Tt(t,e[i],s)}v.listen=Rt;function Lt(t,e,s){for(let i=0,n=e.length;i<n;i+=1)Mt(t,e[i],s)}v.unlisten=Lt;var V={};Object.defineProperty(V,"__esModule",{value:!0});const B={};typeof document<"u"&&(B.body=document.body,B.window=window,B.document=document);const Z=(()=>{if(typeof document<"u"&&document.body){const t=document.body;return typeof t.matches=="function"?"matches":typeof t.webkitMatchesSelector=="function"?"webkitMatchesSelector":typeof t.mozMatchesSelector=="function"?"mozMatchesSelector":typeof t.msMatchesSelector=="function"?"msMatchesSelector":typeof t.oMatchesSelector=="function"?"oMatchesSelector":null}return null})();function Bt(t,e){if(!t)return null;if(B.hasOwnProperty(t))return B[t];if(t[0]==="#")return document.getElementById(t.slice(1));if(Z===null)return null;let s=e;for(;s=s.parentElement;)if(s[Z](t))return s||null;return null}V.default=Bt;var q={};Object.defineProperty(q,"__esModule",{value:!0});function Ft(t){do{const e=window.getComputedStyle(t);if(e.transform!=="none"||e.webkitTransform!=="none")return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null}q.default=Ft;var w={};Object.defineProperty(w,"__esModule",{value:!0});w.isIntersecting=w.getRect=w.infiniteRect=void 0;w.infiniteRect={top:-1/0,bottom:1/0,height:1/0,left:-1/0,right:1/0,width:1/0};function Ht(t){return t&&"getBoundingClientRect"in t&&typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():t===window||t===document?{top:0,left:0,bottom:window.innerHeight,height:window.innerHeight,width:window.innerWidth,right:window.innerWidth}:{top:0,left:0,right:0,bottom:0,width:0,height:0}}w.getRect=Ht;function $t(t,e,s,i){const n=t.top+s,a=t.bottom+i;return n>=e.top&&n<=e.bottom||a>=e.top&&a<=e.bottom||a>=e.bottom&&n<=e.top}w.isIntersecting=$t;var nt=x&&x.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(N,"__esModule",{value:!0});const Dt=it,T=v,J=nt(V),Nt=nt(q),M=w,Wt=(t,e)=>{const{bottomOffset:s,hideOnBoundaryHit:i}=e,{top:n,height:a,width:o,boundaryBottom:l}=t;return i||n+a+s<l?{top:`${n}px`,width:`${o}px`,position:"fixed"}:!i&&l>0?{top:`${l-a-s}px`,width:`${o}px`,position:"fixed"}:{width:`${o}px`,bottom:`${s}px`,position:"absolute"}},zt=(t,e)=>{const{bottomOffset:s,hideOnBoundaryHit:i}=e,{bottom:n,height:a,width:o,boundaryTop:l}=t;return i||n-a-s>l?{width:`${o}px`,top:`${n-a}px`,position:"fixed"}:{width:`${o}px`,top:`${s}px`,position:"absolute"}},Ut=(t,e,s)=>(t==="top"?Wt:zt)(s,e),At=(t,e)=>{const s=t.wrapperStyles,i=e.wrapperStyles;if(t.isFixed!==e.isFixed||t.height!==e.height||!s&&i||s&&!i)return!1;if(!i)return!0;for(const n in s)if(s.hasOwnProperty(n)&&s[n]!==i[n])return!1;return!0};class ot extends Dt.Component{constructor(){super(...arguments),this.holderEl=null,this.wrapperEl=null,this.el=null,this.scrollEl=null,this.boundaryEl=null,this.disabled=!1,this.checkPositionIntervalId=null,this.lastMinHeight=null,this.state={isFixed:!1,wrapperStyles:void 0,holderStyles:void 0,height:0},this.holderRef=e=>{e!==this.holderEl&&(this.holderEl=e)},this.wrapperRef=e=>{e!==this.wrapperEl&&(this.wrapperEl=e,this.updateScrollEl(),this.updateBoundaryEl())},this.checkPosition=()=>{const{holderEl:e,wrapperEl:s,boundaryEl:i,scrollEl:n,disabled:a}=this;if(!n||!e||!s){console.error("Missing required elements:",{scrollEl:n,holderEl:e,wrapperEl:s});return}const{mode:o,onFixedToggle:l,offsetTransforms:c,isIOSFixEnabled:d,dontUpdateHolderHeightWhenSticky:f}=this.props;if(a){this.state.isFixed&&this.setState({isFixed:!1,wrapperStyles:{}});return}if(!e.getBoundingClientRect||!s.getBoundingClientRect)return;const _=e.getBoundingClientRect(),b=s.getBoundingClientRect(),E=i?(0,M.getRect)(i):M.infiniteRect,p=(0,M.getRect)(n),m=this.isFixed(_,b,E,p);let h=null;if(c&&m&&n instanceof HTMLElement){const y=(0,Nt.default)(n);y&&(h=(0,M.getRect)(y))}const g=this.state.isFixed&&f&&this.lastMinHeight?this.lastMinHeight:b.height;this.lastMinHeight=g;const P=d?{transform:"translateZ(0)",WebkitTransform:"translateZ(0)"}:void 0,S={isFixed:m,height:b.height,holderStyles:{minHeight:`${g}px`},wrapperStyles:m?Object.assign(Object.assign({},P),Ut(o,this.props,{boundaryTop:o==="bottom"?E.top:0,boundaryBottom:o==="top"?E.bottom:0,top:o==="top"?p.top-(h?h.top:0):0,bottom:o==="bottom"?p.bottom-(h?h.bottom:0):0,width:_.width,height:b.height})):P};m!==this.state.isFixed&&l&&typeof l=="function"&&l(m),At(this.state,S)||this.setState(S)}}isFixed(e,s,i,n){const{hideOnBoundaryHit:a,bottomOffset:o,topOffset:l,mode:c}=this.props;if(this.disabled||a&&i&&!(0,M.isIntersecting)(i,n,l,o))return!1;const d=a?s.height+o:0;return c==="top"?e.top+l<n.top&&n.top+d<=i.bottom:e.bottom-l>n.bottom&&n.bottom-d>=i.top}updateScrollEl(){if(!this.wrapperEl)return;this.scrollEl&&((0,T.unlisten)(this.scrollEl,["scroll"],this.checkPosition),this.scrollEl=null);const{scrollElement:e}=this.props;typeof e=="string"?this.scrollEl=(0,J.default)(e,this.wrapperEl):this.scrollEl=e,this.scrollEl?(0,T.listen)(this.scrollEl,["scroll"],this.checkPosition):console.error("Cannot find scrollElement "+(typeof e=="string"?e:"unknown"))}updateBoundaryEl(){if(!this.wrapperEl)return;const{boundaryElement:e}=this.props;this.boundaryEl=(0,J.default)(e,this.wrapperEl),(this.boundaryEl===window||this.boundaryEl===document)&&(this.boundaryEl=null)}initialize(){const{positionRecheckInterval:e,disabled:s}=this.props;this.disabled=s,(0,T.listen)(window,["scroll","resize","pageshow","load"],this.checkPosition),this.checkPosition(),e&&(this.checkPositionIntervalId=setInterval(this.checkPosition,e))}componentDidUpdate({scrollElement:e,boundaryElement:s,disabled:i}){(e!==this.props.scrollElement||this.scrollEl===null)&&this.updateScrollEl(),(s!==this.props.boundaryElement||this.boundaryEl===null)&&this.updateBoundaryEl(),i!==this.props.disabled&&(this.disabled=this.props.disabled,this.checkPosition())}componentDidMount(){this.initialize(),this.wrapperEl===null&&console.error("Wrapper element is missing, please make sure that you have assigned refs correctly")}componentWillUnmount(){this.scrollEl&&(0,T.unlisten)(this.scrollEl,["scroll"],this.checkPosition),(0,T.unlisten)(window,["scroll","resize","pageshow","load"],this.checkPosition),this.boundaryEl=null,this.scrollEl=null,this.checkPositionIntervalId&&clearInterval(this.checkPositionIntervalId)}render(){const{holderRef:e,wrapperRef:s}=this,{isFixed:i,wrapperStyles:n,holderStyles:a}=this.state;return this.props.children({holderRef:e,wrapperRef:s,isFixed:i,wrapperStyles:n,holderStyles:a})}}ot.defaultProps={mode:"top",topOffset:0,bottomOffset:0,isIOSFixEnabled:!0,offsetTransforms:!0,disabled:!1,onFixedToggle:void 0,boundaryElement:void 0,hideOnBoundaryHit:!0,scrollElement:"window",dontUpdateHolderHeightWhenSticky:!1};N.default=ot;var rt={};(function(t){var e=x&&x.__rest||function(o,l){var c={};for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&l.indexOf(d)<0&&(c[d]=o[d]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,d=Object.getOwnPropertySymbols(o);f<d.length;f++)l.indexOf(d[f])<0&&Object.prototype.propertyIsEnumerable.call(o,d[f])&&(c[d[f]]=o[d[f]]);return c},s=x&&x.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultProps=void 0;const i=s(it),n=s(N);t.defaultProps=Object.assign(Object.assign({},n.default.defaultProps),{stickyClassName:"sticky",wrapperClassName:"",stickyStyle:{}});function a(o){const l=Object.assign(Object.assign({},t.defaultProps),o),{mode:c,onFixedToggle:d,hideOnBoundaryHit:f,offsetTransforms:_,disabled:b,boundaryElement:E,scrollElement:p,bottomOffset:m,topOffset:h,positionRecheckInterval:g,children:P,isIOSFixEnabled:S,dontUpdateHolderHeightWhenSticky:y,wrapperClassName:W,stickyClassName:z,stickyStyle:I}=l,F=e(l,["mode","onFixedToggle","hideOnBoundaryHit","offsetTransforms","disabled","boundaryElement","scrollElement","bottomOffset","topOffset","positionRecheckInterval","children","isIOSFixEnabled","dontUpdateHolderHeightWhenSticky","wrapperClassName","stickyClassName","stickyStyle"]);return i.default.createElement(n.default,{mode:c,onFixedToggle:d,hideOnBoundaryHit:f,offsetTransforms:_,disabled:b,boundaryElement:E,scrollElement:p,bottomOffset:m,topOffset:h,positionRecheckInterval:g,isIOSFixEnabled:S,dontUpdateHolderHeightWhenSticky:y},({isFixed:k,wrapperStyles:H,wrapperRef:u,holderStyles:C,holderRef:U})=>i.default.createElement("div",Object.assign({},F,{ref:U,style:C}),i.default.createElement("div",Object.assign({},F,{className:`${W} ${k?z:""}`,style:k?Object.assign(Object.assign({},H),I):H,ref:u}),P)))}t.default=a})(rt);var at=x&&x.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(D,"__esModule",{value:!0});D.RenderPropSticky=void 0;const Vt=at(N);D.RenderPropSticky=Vt.default;const qt=at(rt);var Gt=D.default=qt.default;const Qt=t=>st.useEffect(t,Yt),Yt=[],X=({layout:t})=>{const{formatMessage:e}=tt(),{model:s}=et();return r.jsx(Q,{direction:"column",alignItems:"stretch",gap:6,children:t.map((i,n)=>{if(i.some(a=>a.some(o=>o.type==="dynamiczone"))){const[a]=i,[o]=a,l={...o,label:e({id:`content-manager.content-types.${s}.${o.name}`,defaultMessage:o.label})};return r.jsx(O.Root,{gap:4,children:r.jsx(O.Item,{col:12,s:12,xs:12,direction:"column",alignItems:"stretch",children:r.jsx(Y,{...l})})},o.name)}return r.jsx(kt,{hasRadius:!0,background:"neutral0",shadow:"tableShadow",paddingLeft:6,paddingRight:6,paddingTop:6,paddingBottom:6,borderColor:"neutral150",children:r.jsx(Q,{direction:"column",alignItems:"stretch",gap:6,children:i.map((a,o)=>r.jsx(O.Root,{gap:4,children:a.map(({size:l,...c})=>{const d={...c,label:e({id:`content-manager.content-types.${s}.${c.name}`,defaultMessage:c.label})};return r.jsx(O.Item,{col:l,s:12,xs:12,direction:"column",alignItems:"stretch",children:r.jsx(Y,{...d})},c.name)})},o))})},n)})})},Zt=()=>{const t=lt(),[{query:{status:e}},s]=dt({status:"draft"}),{formatMessage:i}=tt(),{toggleNotification:n}=ct(),{document:a,meta:o,isLoading:l,schema:c,components:d,collectionType:f,id:_,model:b,hasError:E}=et(),p=c?.options?.draftAndPublish??!1;Qt(()=>{t?.state&&"error"in t.state&&n({type:"danger",message:t.state.error,timeout:5e3})});const m=ut("EditViewPage",u=>u.isLoading),h=f===Et,g=!_&&!h,{isLoading:P,edit:{layout:S,settings:{mainField:y}}}=ft(b),{isLazyLoading:W}=Ot([]),z=m||l||P||W,I=st.useMemo(()=>{if(!a&&!g&&!h||!c)return;const u=a?.id?a:_t(c,d);return Pt(c,d)(u)},[a,g,h,c,d]);if(E)return r.jsx(j.Error,{});if(z&&!a?.documentId)return r.jsx(j.Loading,{});if(!I)return r.jsx(j.Error,{});const F=u=>{(u==="published"||u==="draft")&&s({status:u},"push",!0)};let k="Untitled";y!=="id"&&a?.[y]?k=a[y]:h&&c?.info.displayName&&(k=c.info.displayName);const H=(u,C)=>G(c?.attributes,d,{status:e,...C}).validateSync(u,{abortEarly:!1});return r.jsxs(ht,{paddingLeft:10,paddingRight:10,children:[r.jsx(j.Title,{children:k}),r.jsx(pt,{disabled:p&&e==="published",initialValues:I,method:g?"POST":"PUT",validate:(u,C)=>G(c?.attributes,d,{status:e,...C}).validate(u,{abortEarly:!1}),initialErrors:t?.state?.forceValidation?H(I,{}):{},children:({resetForm:u})=>r.jsxs(r.Fragment,{children:[r.jsx(mt,{isCreating:g,status:p?Jt(a,o):void 0,title:k}),r.jsxs(R.Root,{variant:"simple",value:e,onValueChange:F,children:[r.jsx(R.List,{"aria-label":i({id:A("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:p?r.jsxs(r.Fragment,{children:[r.jsx(K,{value:"draft",children:i({id:A("containers.edit.tabs.draft"),defaultMessage:"draft"})}),r.jsx(K,{disabled:!o||o.availableStatus.length===0,value:"published",children:i({id:A("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),r.jsxs(O.Root,{paddingTop:8,gap:4,children:[r.jsxs(O.Item,{col:10,m:9,s:12,direction:"column",alignItems:"stretch",children:[r.jsx(R.Content,{value:"draft",children:r.jsx(X,{layout:S})}),r.jsx(R.Content,{value:"published",children:r.jsx(X,{layout:S})})]}),r.jsx(O.Item,{col:2,m:3,s:12,direction:"column",alignItems:"stretch",children:r.jsx(Gt,{children:r.jsx(gt,{})})})]})]}),r.jsx(bt,{onProceed:u})]})})]})},K=St(R.Trigger)`
  text-transform: uppercase;
`,Jt=(t,e)=>{const s=t?.status,i=e?.availableStatus??[];return s?s==="draft"&&i.find(n=>n.publishedAt!==null)?"published":s:"draft"},ae=()=>{const{slug:t=""}=yt(),{permissions:e=[],isLoading:s,error:i}=xt(jt.map(n=>({action:n,subject:t})));return s?r.jsx(j.Loading,{}):i||!t?r.jsx(j.Error,{}):r.jsx(j.Protect,{permissions:e,children:({permissions:n})=>r.jsx(wt,{permissions:n,children:r.jsx(Zt,{})})})};export{Zt as EditViewPage,ae as ProtectedEditViewPage,Jt as getDocumentStatus};
