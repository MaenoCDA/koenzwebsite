const __vite__fileDeps=["MagicLinkEE-Cd6tIx9I-BBY3e_W6.js","strapi-JxO5pAxa.js","strapi-DfCRw63t.css","SelectRoles-CcUNt6ky-CeodMKHu.js","useAdminRoles-C81rIrt0-DwzFcSOB.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{aZ as C,aY as B,ae as z,s as q,c7 as D,an as F,b0 as I,ao as O,ci as V,b9 as N,r as H,j as e,P as c,cj as E,aB as Y,at as $,aA as P,aU as K,bp as G,bq as Q,bj as p,b5 as h,b4 as y,bk as l,aC as Z,br as J,aw as W,ax as v,bs as X,ca as ee}from"./strapi-JxO5pAxa.js";import{s as ae}from"./selectors-DSWA1PgN-DpNRPz9o.js";import{g as se}from"./users-8N93LH7R-MOwOr-tf.js";import{S as te,M as re}from"./SelectRoles-CcUNt6ky-CeodMKHu.js";import{C as ie}from"./validation-B-0tldzN-DESvqOAG.js";import"./useAdminRoles-C81rIrt0-DwzFcSOB.js";const oe=$().shape({...ie,isActive:W(),roles:J().min(1,{id:v.required.id,defaultMessage:"This field is required"}).required({id:v.required.id,defaultMessage:"This field is required"})}),T=["email","firstname","lastname","username","isActive","roles"],ne=()=>{const{formatMessage:a}=C(),b=B("/settings/users/:id")?.params?.id??"",x=z(),{toggleNotification:r}=q(),M=D(re,async()=>(await ee(()=>import("./MagicLinkEE-Cd6tIx9I-BBY3e_W6.js"),__vite__mapDeps([0,1,2,3,4]))).MagicLinkEE),{_unstableFormatAPIError:m,_unstableFormatValidationErrors:L}=F(),A=I(ae),{isLoading:U,allowedActions:{canUpdate:u}}=O({read:A.settings?.users.read??[],update:A.settings?.users.update??[]}),[_]=V(),{data:k,error:i,isLoading:R}=N({id:b},{refetchOnMountOrArgChange:!0}),[o]=k?.users??[];if(H.useEffect(()=>{i&&(i.name==="UnauthorizedError"?(r({type:"info",message:a({id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"})}),x("/")):r({type:"danger",message:m(i)}))},[i,m,a,x,r]),R||!M||U)return e.jsx(c.Loading,{});const j={...E(o,T),roles:o.roles.map(({id:s})=>s),password:"",confirmPassword:""},S=async(s,n)=>{const{confirmPassword:w,...g}=s,t=await _({id:b,...g});"error"in t&&X(t.error)?(t.error.name==="ValidationError"&&n.setErrors(L(t.error)),r({type:"danger",message:m(t.error)})):(r({type:"success",message:a({id:"notification.success.saved",defaultMessage:"Saved"})}),n.setValues({...E(s,T),password:"",confirmPassword:""}))};return e.jsxs(c.Main,{children:[e.jsx(c.Title,{children:a({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Users"})}),e.jsx(Y,{method:"PUT",onSubmit:S,initialValues:j,validationSchema:oe,children:({isSubmitting:s,modified:n})=>e.jsxs(e.Fragment,{children:[e.jsx(P.Header,{primaryAction:e.jsx(G,{disabled:s||!u||!n,startIcon:e.jsx(Q,{}),loading:s,type:"submit",children:a({id:"global.save",defaultMessage:"Save"})}),title:a({id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},{name:se(j)}),navigationAction:e.jsx(K,{fallback:"../users"})}),e.jsxs(P.Content,{children:[o?.registrationToken&&e.jsx(p,{paddingBottom:6,children:e.jsx(M,{registrationToken:o.registrationToken})}),e.jsxs(h,{direction:"column",alignItems:"stretch",gap:7,children:[e.jsx(p,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsxs(h,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(y,{variant:"delta",tag:"h2",children:a({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})}),e.jsx(l.Root,{gap:5,children:de.map(w=>w.map(({size:g,label:t,...d})=>e.jsx(l.Item,{col:g,direction:"column",alignItems:"stretch",children:e.jsx(Z,{...d,disabled:!u,label:a(t),placeholder:"placeholder"in d?a(d.placeholder):void 0})},d.name)))})]})}),e.jsx(p,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsxs(h,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(y,{variant:"delta",tag:"h2",children:a({id:"global.roles",defaultMessage:"User's role"})}),e.jsx(l.Root,{gap:5,children:e.jsx(l.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(te,{disabled:!u})})})]})})]})]})]})})]})},de=[[{label:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"string",size:6,required:!0},{label:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"string",size:6}],[{label:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:6,required:!0},{label:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"string",size:6}],[{autoComplete:"new-password",label:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:6},{autoComplete:"new-password",label:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:6}],[{label:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"boolean",size:6}]],fe=()=>{const a=I(f=>f.admin_app.permissions.settings?.users.read);return e.jsx(c.Protect,{permissions:a,children:e.jsx(ne,{})})};export{ne as EditPage,fe as ProtectedEditPage};
